# Конфигурация Nginx для демо приложения с ограничением доступа через VPN
server {
    listen 80;
    server_name _;
    
    # Ограничение доступа только для VPN клиентов
    # Разрешаем доступ только с VPN подсетей
    allow 127.0.0.1;           # Localhost для тестирования
    allow 192.168.241.0/24;    # VPN подсеть Pritunl (реальная)
    allow 172.16.0.0/12;       # Docker/VPN подсети
    allow 192.168.0.0/16;      # Локальные подсети
    deny all;                   # Блокируем все остальные
    
    root /var/www/demo-app;
    index index.html;
    
    # Основная директория
    location / {
        try_files $uri $uri/ =404;
        
        # Дополнительные заголовки безопасности
        add_header X-Frame-Options "SAMEORIGIN" always;
        add_header X-Content-Type-Options "nosniff" always;
        add_header X-XSS-Protection "1; mode=block" always;
    }
    
    # Специальный блок для корневого пути (избегает циклов)
    location = / {
        try_files /index.html =404;
    }
    
    # Блокировка доступа к служебным файлам
    location ~ /\. {
        deny all;
        access_log off;
        log_not_found off;
    }
    
    # Настройка кэширования для статических файлов
    location ~* \.(css|js|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
    
    # Логирование
    access_log /var/log/nginx/demo-app.access.log;
    error_log /var/log/nginx/demo-app.error.log;
    
    # Ограничение размера загружаемых файлов
    client_max_body_size 1M;
}
